<!DOCTYPE html>
<html lang="pt-br" dir="ltr">
    <head>
        <meta charset="utf-8">
        <title>Planejador de Excursão</title>
        <style media="screen">
            body {
                background-color: #f5fffd;
            }
            .excursion {
                background-color: #e9f2fd;
                border-radius: 8px;
                margin: 16px;
                box-shadow: 0 2px 4px -1px rgba(0, 0, 0, 0.5);
            }

            .create {
                display: flex;
                padding: 10px;
                background-color: #bce0f5;
                border-top-left-radius: 8px;
                border-top-right-radius: 8px;
            }
            .create .field {
                display: flex;
                align-items: center;
            }
            .create #new-person-name {
                flex: 3;
            }
            .create #new-person-age {
                flex: 1;
            }

            .create .field input {
                flex: 1;
                margin: 0 8px;
                padding: 4px;
                padding-left: 12px;
            }

            .create #register {
                width: 100px;
            }

            .people-list {
                display: flex;
                border-top: 1px solid rgba(0, 0, 0, 0.5);
            }

            .adults, .students {
                padding: 0 20px;
                flex: 1;
            }
            .students {
                border-left: 1px solid rgba(0, 0, 0, 0.2);
            }

            .people-list ul {
                padding-left: 16px;
            }

            .people-list li {
                padding: 4px;
                cursor: pointer
            }
            .people-list li:hover {
                background-color: rgba(0, 0, 0, 0.07);
            }

            .edit {
                display: flex;
                flex-direction: column;
                padding: 10px;
                background-color: #bce0f5;
                border-radius: 8px;
                margin-top: 4px;
                margin-bottom: 12px;
            }

            .edit .field {
                display: flex;
                align-items: center;
                padding-bottom: 6px;
            }
            .edit .field span {
                text-align: right;
                width: 50px;
            }
            .edit .field input {
                flex: 1;
                margin-left: 8px;
                padding: 4px;
                padding-left: 12px;
            }

            .edit .actions {
                display: flex;
                margin-top: 8px;
                justify-content: flex-end;
            }
            .edit .actions button {
                margin-left: 8px;
                height: 27px;
                width: 100px;
            }
        </style>
    </head>
    <body>
        <h1>Planejador de Excursão</h1>
        <div class="excursion">
            <form class="create" action="">
                <label id="new-person-name" class="field">
                    <span>Nome:</span>
                    <input type="text" name="person-name" placeholder="Digite o nome aqui">
                </label>
                <label id="new-person-age" class="field">
                    <span>Idade:</span>
                    <input type="number" min="1" name="person-age" placeholder="Digite a idade aqui">
                </label>
                <button id="register" type="button" name="add">Cadastrar</button>
            </form>
            <div class="people-list">
                <section class="adults">
                    <h1>Adultos</h1>
                    <ul id="adults-list">
                        <li>Marcelo - 22</li>
                        <li>Jõao - 31</li>
                        <li>Diogo - 19</li>
                        <li>Octávio - 18</li>
                    </ul>
                </section>
                <section class="students">
                    <h1>Estudantes</h1>
                    <ul id="students-list">
                        <li>Lia - 15</li>
                        <li>Alguem - 8</li>
                        <li>Paula - 17</li>
                    </ul>
                </section>
            </div>
        </div>

        <template id="edit-template">
            <form class="edit" action="">
                <input type="hidden" name="person-id" value="1">
                <label class="field">
                    <span>Nome:</span>
                    <input type="text" name="person-name" placeholder="Digite o nome aqui" value="Alguem">
                </label>
                <label class="field">
                    <span>Idade:</span>
                    <input type="number" min="1" name="person-age" placeholder="Digite a idade aqui" value="17">
                </label>
                <div class="actions">
                    <button type="button" name="delete">Excluir</button>
                    <button type="button" name="update">Atualizar</button>
                </div>
            </form>
        </template>

        <script type="text/javascript">
            var adultsListElem = document.getElementById("adults-list")
            var studentsListElem = document.getElementById("students-list")

            var adultsList = {
                0: {name: 'Marcelo', age: 22},
                1: {name: 'Jõao', age: 31},
                2: {name: 'Diogo', age: 19},
                3: {name: 'Octávio', age: 18},
            };
            var studentsList = {
                0: {name: "Lia", age: 15},
                1: {name: "Alguem", age: 8},
                2: {name: "Paula", age: 17},
            };

            currentEditForm = null;
            function createEditForm(list, id)
            {
                if (currentEditForm)
                    currentEditForm.remove();

                var template = document.getElementById("edit-template");

                var clone = document.importNode(template.content, true).firstElementChild;

                clone.elements["person-id"].value = id;
                clone.elements["person-name"].value = list[id].name;
                clone.elements["person-age"].value = list[id].age;

                clone.elements["delete"].addEventListener("click", function() {
                    console.log("Delete " + list[id].name);
                })

                clone.elements["update"].addEventListener("click", function() {
                    console.log("Update " + list[id].name);
                })

                currentEditForm = clone;
                return clone;
            }

            function editFunction(elem, list, id) {
                return function () {
                    elem.appendChild(createEditForm(list, id));
                };
            }
            function refreshList(elem, newList) {
                while (elem.firstChild)
                    elem.removeChild(elem.firstChild);

                for (let id in newList) {
                    newPerson = document.createElement('li');
                    newPerson.textContent = newList[id].name + " - " + newList[id].age;

                    newPerson.addEventListener("click", editFunction(newPerson, newList, id));

                    elem.appendChild(newPerson);
                }
            }

            refreshList(adultsListElem, adultsList);
            refreshList(studentsListElem, studentsList);

            studentsListElem.children[1].appendChild(createEditForm(studentsList, 1));
            // document.body.appendChild(createEditForm(studentsList, 1));
            // document.body.appendChild(createEditForm(studentsList, 2));
        </script>
    </body>
</html>
